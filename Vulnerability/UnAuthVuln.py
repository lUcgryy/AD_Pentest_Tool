from Vulnerability.Vuln import Vuln_Base
from Util.writeHelper import *
from colorama import Fore, Style
from Enumeration.LDAPSession import *
import ldap3

class UnAuth_Vuln(Vuln_Base):
    def __init__(self, name, severity, description, session, ip):
        super().__init__(name, severity, description, session)
        self.ip = ip
        print('init UnAuth_Vuln')
        
    def scan_vulnerability(self):
        self.scan_anonymous_LDAP()
        # print(Fore.GREEN + "[+] Scanning completed" + Style.RESET_ALL)
        
    def scan_anonymous_LDAP(self):
        try:
            print(Fore.GREEN + "[+] Scanning for LDAP anonymous bind" + Style.RESET_ALL)
            print(Fore.GREEN + "Reference: https://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/" + Style.RESET_ALL)
            self.session = LDAPSession(self.ip, '','')
            print(Fore.RED + "[+] LDAP allow anonymous bind" + Style.RESET_ALL)
        except ldap3.core.exceptions.LDAPBindError:
            print(Fore.GREEN + "[+] LDAP does not allow anonymous bind" + Style.RESET_ALL)
            return