import uuid
from smbprotocol.connection import Connection
from smbprotocol.session import Session
from smbprotocol.tree import TreeConnect
from smbprotocol.open import Open, CreateDisposition, FileAttributes, CreateOptions, FilePipePrinterAccessMask, DirectoryAccessMask

server = "192.168.0.104"
username = "giangtran@capstone.local"
password = "qwerty123"
share_name = "<share_name>"

# Khởi tạo kết nối
connection = Connection(uuid.uuid4(), server, 445)
connection.connect()
session = Session(connection, username, password)
session.connect()

# Kết nối tới share
tree = TreeConnect(session, "\\\\%s\\%s" % (server, share_name))
tree.connect()

# Mở directory
directory = Open(tree, "\\")
directory.create(
    CreateDisposition.FILE_OPEN,
    DirectoryAccessMask.GENERIC_READ,
    FileAttributes.FILE_ATTRIBUTE_DIRECTORY,
    CreateOptions.FILE_DIRECTORY_FILE
)

# Liệt kê các file và thư mục
for file_info in directory.query_directory("*"):
    print(file_info.file_name)

# Đóng kết nối
directory.close()
tree.disconnect()
session.disconnect()
connection.disconnect()
